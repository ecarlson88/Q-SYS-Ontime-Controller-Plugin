-- Information block for the plugin
PluginInfo = {
    Name = "Ontime Controller",
    Version = "3.0.0",
    BuildVersion = "0.3.0.0",
    Id = "e228364d-8e3d-3253-be94-bcb75ha2c76e",
    Author = "Erik Carlson",
    Description = "Controller For Ontime"  
  }
  
  -- Define the color of the plugin object in the design
  function GetColor(props)
    return { 80, 80, 80 }
  end
  
    -- Define User configurable Properties of the plugin
  function GetProperties()
      local props = {}
      return props
    end
    
  -- The name that will initially display when dragged into a design
  function GetPrettyName(props)
    return "Ontime Controller " .. PluginInfo.Version
  end
  
  -- Optional function used if plugin has multiple pages
  PageNames = { "Timer", "Event","Messaging", "Info" }  --List the pages within the plugin
  function GetPages(props)
    local pages = {}
    for ix,name in ipairs(PageNames) do
      table.insert(pages, {name = PageNames[ix]})
    end
    return pages
  end

  -- Defines the Controls used within the plugin
  function GetControls(props)
    local ctrls = {}
    table.insert(ctrls, {
      Name = "Play",
      ControlType = "Button",
      ButtonType = "Trigger",
      Count = 1,
      UserPin = true,
      PinStyle = "Input",
      Icon = "Play",
      IconColor = {47,133,90}
    })
    table.insert(ctrls, {
      Name = "Minus 1",
      ControlType = "Button",
      ButtonType = "Trigger",
      Count = 1,
      UserPin = true,
      PinStyle = "Input"
    })
    table.insert(ctrls, {
      Name = "Plus 5",
      ControlType = "Button",
      ButtonType = "Trigger",
      Count = 1,
      UserPin = true,
      PinStyle = "Input"
    })
    table.insert(ctrls, {
      Name = "Minus 5",
      ControlType = "Button",
      ButtonType = "Trigger",
      Count = 1,
      UserPin = true,
      PinStyle = "Input"
    })
    table.insert(ctrls, {
      Name = "Plus 1",
      ControlType = "Button",
      ButtonType = "Trigger",
      Count = 1,
      UserPin = true,
      PinStyle = "Input"
    })
    table.insert(ctrls, {
      Name = "Pause",
      ControlType = "Button",
      ButtonType = "Trigger",
      Count = 1,
      UserPin = true,
      PinStyle = "Input",
      Icon = "Pause"
    })
    table.insert(ctrls, {
      Name = "Restart",
      ControlType = "Button",
      ButtonType = "Trigger",
      Count = 1,
      UserPin = true,
      PinStyle = "Input",
      Icon = "Refresh"
    })
    table.insert(ctrls, {
      Name = "Blink",
      ControlType = "Button",
      ButtonType = "Toggle",
      Count = 1,
      UserPin = true,
      PinStyle = "Input",
    })
    table.insert(ctrls, {
      Name = "BlinkBlink",
      ControlType = "Button",
      ButtonType = "Toggle",
      Count = 1,
      UserPin = false,
      Icon = "Burst"
    })
    table.insert(ctrls, {
      Name = "Blank",
      ControlType = "Button",
      ButtonType = "Toggle",
      Count = 1,
      UserPin = true,
      PinStyle = "Input",
      Icon = "Prohibited"
    })
    table.insert(ctrls, {
      Name = "T-MessageVis",
      ControlType = "Button",
      ButtonType = "Toggle",
      Count = 1,
      UserPin = true,
      PinStyle = "Input",
      Icon = "Eye"
    })
    table.insert(ctrls, {
      Name = "P-MessageVis",
      ControlType = "Button",
      ButtonType = "Toggle",
      Count = 1,
      UserPin = true,
      PinStyle = "Input",
      Icon = "Eye"
    })
    table.insert(ctrls, {
      Name = "Send TimerMessage",
      ControlType = "Button",
      ButtonType = "Trigger",
      Count = 1,
      UserPin = true,
      PinStyle = "Input",
      Icon = "Checkbox"
    })
    table.insert(ctrls, {
      Name = "Send PublicMessage",
      ControlType = "Button",
      ButtonType = "Trigger",
      Count = 1,
      UserPin = true,
      PinStyle = "Input",
      Icon = "Checkbox"
    })
    table.insert(ctrls, {
      Name = "Next",
      ControlType = "Button",
      ButtonType = "Trigger",
      Count = 1,
      UserPin = true,
      PinStyle = "Input",
      Icon = "Next"
    })
    table.insert(ctrls, {
        Name = "Previous",
        ControlType = "Button",
        ButtonType = "Trigger",
        Count = 1,
        UserPin = true,
        PinStyle = "Input",
        Icon = "Previous"
    })
    table.insert(ctrls, {
      Name = "Current T-Message",
      ControlType = "Text",
      Count = 1,
      UserPin = false
    })
    table.insert(ctrls, {
      Name = "Current P-Message",
      ControlType = "Text",
      Count = 1,
      UserPin = false
    })
    table.insert(ctrls, {
      Name = "TimerMessage",
      ControlType = "Text",
      Count = 1,
      PinStyle = "Input",
      UserPin = true
    })
    table.insert(ctrls, {
      Name = "PublicMessage",
      ControlType = "Text",
      Count = 1,
      PinStyle = "Input",
      UserPin = true
    })
    table.insert(ctrls, {
      Name = "Event_Title",
      ControlType = "Text",
      Count = 1,
      UserPin = false
    })
    table.insert(ctrls, {
      Name = "Note",
      ControlType = "Text",
      Count = 1,
      UserPin = false
    })
    table.insert(ctrls, {
      Name = "Next_Event_Title",
      ControlType = "Text",
      Count = 1,
      UserPin = false
    })
    table.insert(ctrls, {
      Name = "Next_Note",
      ControlType = "Text",
      Count = 1,
      UserPin = false
    })
    table.insert(ctrls, {
      Name = "Time_Remaining",
      ControlType = "Text",
      Count = 1,
      UserPin = false,
      FontSize = 28,
      FrontColor = {255,255,255}
    })
    table.insert(ctrls, {
      Name = "Neg_Time_Remaining",
      ControlType = "Text",
      Count = 1,
      UserPin = false,
      FontSize = 28,
      FrontColor = {255,0,0}
    })
    table.insert(ctrls, {
      Name = "ontime_IP",
      ControlType = "Text",
      Count = 1,
      UserPin = false
    })
    table.insert(ctrls, {
      Name = "Port",
      ControlType = "Text",
      Count = 1,
      UserPin = false,
      DefaultValue = "4001"
    })
    table.insert(ctrls, {
      Name = "Event_Index",
      ControlType = "Knob",
      ControlUnit = "Integer",
      Min = 0,
      Max = 100,
      Count = 1,
      UserPin = true,
      PinStyle = "Output",
    })
    table.insert(ctrls, {
      Name = "Event_Total",
      ControlType = "Knob",
      ControlUnit = "Integer",
      Min = 0,
      Max = 100,
      Count = 1,
      UserPin = true,
      PinStyle = "Output",
    })
    table.insert(ctrls,{
      Name = "On_Air",
      ControlType = "Indicator",
      IndicatorType = "Led",
      UserPin = true,
      PinStyle = "Output",
      Count = 1
    })
    table.insert(ctrls, {
      Name = "Set_OnAir",
      ControlType = "Button",
      ButtonType = "Toggle",
      Count = 1,
      UserPin = true,
      PinStyle = "Input"
    })
    return ctrls
  end
  
  
  --Layout of controls and graphics for the plugin UI to display
  function GetControlLayout(props)
  
      function getImages()
        Logo = "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"
        end; getImages()
    local layout = {}
    local graphics = {}
    local CurrentPage = PageNames[props["page_index"].Value]  
      table.insert(graphics,{ --- black background
            Type = "GroupBox",
            Fill = {34,34,34},
            Radius = 8,
            Position = {5,5},
            Size = {600,295}
          })
      table.insert(graphics,{ ---gray background
            Type = "GroupBox",
            Fill = {45,45,45},
            Radius = 8,
            Position = {100,55},
            Size = {490,235}
          })
      table.insert(graphics, {
            Type = "Image",
            Image = Logo,
            Size = {92, 92},
            Position = {10,10}
          })
      table.insert(graphics,{
              Type = "Text",
              Text = "Ontime controller",
              Position = {100,15},
              Size = {225,38},
              FontSize = 24,
              Color = {128,128,101},
              Font = "Poppins",
              HTextAlign = "Left"
          })
      table.insert(graphics,{
              Type = "Text",
              Text = "ontime IP:",
              Position = {370,23},
              Size = {85,20},
              FontSize = 16,
              Color = {128,57,57},
              HTextAlign = "Left"
          })
      layout["ontime_IP"] = {
              PrettyName = "ontime IP",
              Style = "Text",
              CornerRadius = 4,
              FontSize = 12,
              Position = {450,23},
              Size = {78,20}
          }
      layout["Port"] = {
                PrettyName = "Port #",
                Style = "Text",
                CornerRadius = 4,
                FontSize = 12,
                Position = {530,23},
                Size = {40,20}
          }
    if CurrentPage == "Timer" then
      table.insert(graphics,{ --timer background
            Type = "GroupBox",
            Fill = {35,35,35},
            Radius = 8,
            Position = {110,64},
            Size = {470,105}
          })
      table.insert(graphics,{ --controls background
          Type = "GroupBox",
          Fill = {35,35,35},
          Radius = 8,
          Position = {110,176},
          Size = {470,105}
          })
          table.insert(graphics,{ ---event count /
          Type = "Text",
          Text = "/",
          Position = {540,70},
          Size = {15,20},
          FontSize = 12,
          Color = {220,220,220},
          HTextAlign = "Center"
        })
      layout["Play"] = {
        PrettyName = "Play",
        Style = "Button",
        Radius = 4,
        StrokeColor = {47,133,90},
        StrokeWidth = 1,
        ButtonVisualStyle = "Flat",
        Position = {120,183},
        Size = {90,45},
        Color = {51,158,78},
        UnlinkOffColor = true,
        OffColor = {28,28,28}
      }
      layout["Minus 1"] = {
        PrettyName = "Minus 1",
        Style = "Button",
        Radius = 4,
        FontSize = 20,
        Font = "Droid Sans",
        StrokeColor = {255,255,255},
        StrokeWidth = 1,
        ButtonVisualStyle = "Flat",
        Position = {308,183},
        Size = {55,45},
        Legend = "-1",
        Color = {51,158,78},
        UnlinkOffColor = true,
        OffColor = {28,28,28}
      }
      layout["Plus 1"] = {
        PrettyName = "Plus 1",
        Style = "Button",
        Radius = 4,
        FontSize = 20,
        Font = "Droid Sans",
        StrokeColor = {255,255,255},
        StrokeWidth = 1,
        ButtonVisualStyle = "Flat",
        Position = {363,183},
        Size = {55,45},
        Legend = "+1",
        Color = {51,158,78},
        UnlinkOffColor = true,
        OffColor = {28,28,28}
      }
      layout["Minus 5"] = {
        PrettyName = "Minus 5",
        Style = "Button",
        Radius = 4,
        FontSize = 20,
        Font = "Droid Sans",
        StrokeColor = {255,255,255},
        StrokeWidth = 1,
        ButtonVisualStyle = "Flat",
        Position = {308,228},
        Size = {55,45},
        Legend = "-5",
        Color = {51,158,78},
        UnlinkOffColor = true,
        OffColor = {28,28,28}
      }
      layout["Plus 5"] = {
        PrettyName = "Plus 5",
        Style = "Button",
        Radius = 4,
        FontSize = 20,
        Font = "Droid Sans",
        StrokeColor = {255,255,255},
        StrokeWidth = 1,
        ButtonVisualStyle = "Flat",
        Position = {363,228},
        Size = {55,45},
        Legend = "+5",
        Color = {51,158,78},
        UnlinkOffColor = true,
        OffColor = {28,28,28}
      }
      layout["Pause"] = {
        PrettyName = "Pause",
        Style = "Button",
        Radius = 4,
        StrokeColor = {109,63,33},
        StrokeWidth = 1,
        ButtonVisualStyle = "Flat",
        Position = {210,183},
        Size = {90,45},
        Color = {192,86,33},
        UnlinkOffColor = true,
        OffColor = {28,28,28}
      }
      layout["Previous"] = {
        PrettyName = "Previous",
        Style = "Button",
        Radius = 4,
        StrokeColor = {255,255,255},
        StrokeWidth = 1,
        ButtonVisualStyle = "Flat",
        Position = {120,228},
        Size = {90,45},
        Color = {40,40,40},
        UnlinkOffColor = true,
        OffColor = {28,28,28}
      }
      layout["Next"] = {
        PrettyName = "Next",
        Style = "Button",
        Radius = 4,
        StrokeColor = {255,255,255},
        StrokeWidth = 1,
        ButtonVisualStyle = "Flat",
        Position = {210,228},
        Size = {90,45},
        Color = {40,40,40},
        UnlinkOffColor = true,
        OffColor = {28,28,28}
      }
      layout["Restart"] = {
        PrettyName = "Restart",
        Style = "Button",
        Radius = 4,
        StrokeColor = {255,255,255},
        StrokeWidth = 1,
        ButtonVisualStyle = "Flat",
        Position = {424,182},
        Size = {50,90},
        Color = {40,40,40},
        UnlinkOffColor = true,
        OffColor = {28,28,28}
      }
      layout["BlinkBlink"] = {
        Style = "Button",
        Radius = 4,
        StrokeColor = {255,255,255},
        StrokeWidth = 1,
        ButtonVisualStyle = "Flat",
        Position = {472,182},
        Size = {50,90},
        Color = {10,67,185},
        UnlinkOffColor = true,
        OffColor = {28,28,28}
      }
      layout["Blink"] = {
        PrettyName = "Blink",
        Style = "Button",
        Radius = 4,
        StrokeColor = {255,255,255},
        StrokeWidth = 1,
        ButtonVisualStyle = "Flat",
        Position = {472,182},
        Size = {50,90},
        Color = {0,0,0,0},
        ZOrder = 200
      }
      layout["Blank"] = {
        PrettyName = "Black Out",
        Style = "Button",
        Radius = 4,
        StrokeColor = {255,255,255},
        StrokeWidth = 1,
        ButtonVisualStyle = "Flat",
        Position = {521,182},
        Size = {50,90},
        Color = {10,67,185},
        UnlinkOffColor = true,
        OffColor = {28,28,28}
      }
      layout["Time_Remaining"] = {
        PrettyName = "Time Remaining",
        Style = "Text",
        TextBoxStyle = "NoBackground",
        TextColor={225,225,225},
        Position = {208,75},
        Size = {260,75},
        IsReadOnly = true,
        FontSize = 62,
        }
      layout["Neg_Time_Remaining"] = {
          PrettyName = "Neg_Time Remaining",
          Style = "Text",
          TextBoxStyle = "NoBackground",
          TextColor={225,0,0},
          Position = {199,75},
          Size = {260,75},
          IsReadOnly = true,
          FontSize = 62,
         }
      layout["Event_Index"] = {
        PrettyName = "Event Index",
        Style = "Text",
        TextBoxStyle = "NoBackground",
        TextColor={225,225,225},
        Position = {522,70},
        Size = {20,20},
        IsReadOnly = true,
        FontSize = 13,
        HTextAlign = "Right"
        }
      layout["Event_Total"] = {
        PrettyName = "Event Total",
        TextBoxStyle = "NoBackground",
        TextColor={225,225,225},
        Position = {552,70},
        Size = {20,20},
        IsReadOnly = true,
        FontSize = 13,
        HTextAlign = "Left"
        }
    elseif CurrentPage == "Event" then
      table.insert(graphics,{ --Current Event background
            Type = "GroupBox",
            Fill = {35,35,35},
            Radius = 8,
            Position = {110,64},
            Size = {470,105}
          })
      table.insert(graphics,{ --Next Event background
          Type = "GroupBox",
          Fill = {35,35,35},
          Radius = 8,
          Position = {110,176},
          Size = {470,105}
          })

      ----Event Counter----

        table.insert(graphics,{ ---event count /
          Type = "Text",
          Text = "/",
          Position = {540,70},
          Size = {15,20},
          FontSize = 12,
          Color = {220,220,220},
          HTextAlign = "Center"
          })
        layout["Event_Index"] = {
          PrettyName = "Event Index",
          Style = "Text",
          TextBoxStyle = "NoBackground",
          TextColor={225,225,225},
          Position = {522,70},
          Size = {20,20},
          IsReadOnly = true,
          FontSize = 13,
          HTextAlign = "Right"
          }
        layout["Event_Total"] = {
          PrettyName = "Event Total",
          TextBoxStyle = "NoBackground",
          TextColor={225,225,225},
          Position = {552,70},
          Size = {20,20},
          IsReadOnly = true,
          FontSize = 13,
          HTextAlign = "Left"
          }

      ----Current Event Stuff

        table.insert(graphics,{
            Type = "Text",
            Text = "Event Title",
            CornerRadius = 6,
            Position = {168,64},
            Size = {120,30},
            FontSize = 14,
            Color = {220,220,220},
            HTextAlign = "Left"
          })
          layout["Event_Title"] = {
            PrettyName = "Event Title",
            CornerRadius = 6,
            Style = "Text",
            FontSize = 10,
            IsReadOnly = true,
            Position = {170,89},
            Size = {185,25},
            }
        table.insert(graphics,{
            Type = "Text",
            Text = "Event Notes",
            Position = {168,110},
            Size = {120,30},
            FontSize = 14,
            Color = {220,220,220},
            HTextAlign = "Left"
          })          
          layout["Note"] = {
            PrettyName = "Event Notes",
            CornerRadius = 6,
            Style = "Text",
            FontSize = 10,
            IsReadOnly = true,
            Position = {170,136},
            Size = {185,25},
            }
      ----Next Event Stuff----
      
        table.insert(graphics,{
            Type = "Text",
            Text = "Next Event Title",
            Position = {168,172},
            Size = {120,30},
            FontSize = 14,
            Color = {220,220,220},
            HTextAlign = "Left"
          })
        table.insert(graphics,{
            Type = "Text",
            Text = "Next Event Notes",
            Position = {168,222},
            Size = {125,30},
            FontSize = 14,
            Color = {220,220,220},
            HTextAlign = "Left"
          })
        layout["Next_Event_Title"] = {
          PrettyName = "Next Event Title",
          CornerRadius = 6,
          Style = "Text",
          FontSize = 10,
          IsReadOnly = true,
          Position = {170,198},
          Size = {185,25},
          }
        layout["Next_Note"] = {
          PrettyName = "Next Event Notes",
          CornerRadius = 6,
          Style = "Text",
          FontSize = 10,
          IsReadOnly = true,
          Position = {170,247},
          Size = {185,25},
          }     
    elseif CurrentPage == "Messaging" then  
      table.insert(graphics,{ --Timer Messaging background
        Type = "GroupBox",
        Fill = {35,35,35},
        Radius = 8,
        Position = {110,64},
        Size = {470,105}
      })
      table.insert(graphics,{ --Public Messaging background
        Type = "GroupBox",
        Fill = {35,35,35},
        Radius = 8,
        Position = {110,176},
        Size = {470,105}
      })
      table.insert(graphics,{
        Type = "Text",
        Text = "Current Timer Message",
        Position = {168,64},
        Size = {180,30},
        FontSize = 14,
        Color = {220,220,220},
        HTextAlign = "Left"
      })
      layout["Current T-Message"] = {
        PrettyName = "Current Timer Message",
        CornerRadius = 6,
        Style = "Text",
        FontSize = 10,
        IsReadOnly = true,
        Position = {170,89},
        Size = {180,25},
        }
      table.insert(graphics,{
        Type = "Text",
        Text = "Set Timer Message",
        Position = {168,110},
        Size = {180,30},
        FontSize = 14,
        Color = {220,220,220},
        HTextAlign = "Left"
       })          
      layout["TimerMessage"] = {
          PrettyName = "Timer Message",
          CornerRadius = 6,
          Style = "Text",
          FontSize = 10,
          Position = {170,136},
          Size = {180,25},
          }
      table.insert(graphics,{
         Type = "Text",
         Text = "Current Public Message",
         Position = {168,174},
         Size = {180,30},
         FontSize = 14,
         Color = {220,220,220},
         HTextAlign = "Left"
        })
      layout["Current P-Message"] = {
         PrettyName = "Current Public Message",
         CornerRadius = 6,
         Style = "Text",
         FontSize = 10,
         IsReadOnly = true,
         Position = {170,199},
         Size = {180,25},
        }
      table.insert(graphics,{
         Type = "Text",
         Text = "Set Public Message",
         Position = {168,222},
         Size = {180,30},
         FontSize = 14,
         Color = {220,220,220},
         HTextAlign = "Left"
        })
      layout["PublicMessage"] = {
         PrettyName = "Public Message",
         CornerRadius = 6,
         Style = "Text",
         FontSize = 10,
         Position = {170,247},
         Size = {180,25},
        }
      layout["Blink"] = {
          PrettyName = "Blink",
          Style = "Button",
          Radius = 4,
          StrokeColor = {255,255,255},
          StrokeWidth = 2,
          ButtonVisualStyle = "Flat",
          Position = {455,70},
          Size = {50,90},
          Color = {0,0,0,0},
          ZOrder = 200
        }
        layout["BlinkBlink"] = {
          Style = "Button",
          Radius = 4,
          StrokeColor = {255,255,255},
          StrokeWidth = 2,
          ButtonVisualStyle = "Flat",
          Position = {455,70},
          Size = {50,90},
          Color = {10,67,185},
          UnlinkOffColor = true,
          OffColor = {28,28,28}
        }
      layout["T-MessageVis"] = {
          PrettyName = "Timer Message Visible",
          Style = "Button",
          Radius = 4,
          StrokeColor = {255,255,255},
          StrokeWidth = 2,
          ButtonVisualStyle = "Flat",
          Position = {510,70},
          Size = {50,90},
          Color = {10,67,185},
          UnlinkOffColor = true,
          OffColor = {28,28,28}
        }
      layout["P-MessageVis"] = {
          PrettyName = "Public Message Visible",
          Style = "Button",
          Radius = 4,
          StrokeColor = {255,255,255},
          StrokeWidth = 2,
          ButtonVisualStyle = "Flat",
          Position = {510,183},
          Size = {50,90},
          Color = {10,67,185},
          UnlinkOffColor = true,
          OffColor = {28,28,28}
        }
      layout["Send TimerMessage"] = {
          PrettyName = "Send Timer Message",
          Style = "Button",
          Radius = 4,
          StrokeColor = {255,255,255},
          StrokeWidth = 1,
          ButtonVisualStyle = "Flat",
          Position = {355,133},
          Size = {40,31},
          Color = {34,160,34}
        }
      layout["Send PublicMessage"] = {
          PrettyName = "Send Public Message",
          Style = "Button",
          Radius = 4,
          StrokeColor = {255,255,255},
          StrokeWidth = 1,
          ButtonVisualStyle = "Flat",
          Position = {355,244},
          Size = {40,31},
          Color = {34,160,34}
        }



    else
        table.insert(graphics,{
          Type = "Text",
          Text = "This plugin is used to control the Ontime stage timer application via its websocket API.You will need Ontime running on a device on the same subnet as the core in order to control. Ontime can be downloaded at https://getontime.no",
          Position = {150,60},
          Size = {400,220},
          FontSize = 18,
          Color = {220,220,220},
          HTextAlign = "Left"
        })
      table.insert(graphics, {
        Type = "Image",
        Image = Logo,
        Size = {92, 92},
        Position = {10,10}
      })

    end
    return layout, graphics
  end
  
  --Start event based logic
if Controls then

  --Variables--

 IP = Controls.ontime_IP
 WS_Port = Controls.Port.String
 delay = Timer.New()
 polltimer = Timer.New()
 json = require("rapidjson")
 ws = WebSocket.New()


 IP.EventHandler = function()
    if IP.String == "" then  -- If the user enters blank IP stop communication
      Disconnect()
    else
      Connect()  -- Otherwise Call Connect when the IPAddress EventHandler is called
    end
 end
 function Connect()
  if IP ~= "" then
    ws:Connect("ws",IP.String,"/ws", WS_Port)
    --print("Websocket Connect:",IP.String,"/ws", WS_Port)
  end
 end
 ws.Connected = function()
    print("Websocket Connected:"..IP.String.."/ws:"..WS_Port)
    polltimer:Start(.33)
 end
 function Disconnect()
   ws:Close()
   stopFlashTimer()
   polltimer:Stop()
   print("Disconnected")
 end
 ws.Data = function(ws, data) ---All of feedback
    response = data
    responsetbl = json.decode(response)

    if responsetbl.type == "ontime-log" then
            LogFB(data)
    elseif responsetbl.type == "poll" then
            TimerFB(data)

  end
 end

 local function setControlString(control, value)
  if value then
    Controls[control].String = value
  end
end

local function setControlValue(control, value)
  Controls[control].Value = value
end

local function setControlVisibility(control, isVisible)
  Controls[control].IsInvisible = not isVisible
end

function TimerFB(data)
 -- print("TIMER DATA", data)
  
  local payload = responsetbl.payload
  local playback = payload.timer.playback
  print(playback)

  -- Handle timer display
  if playback == "roll" then
    setControlString("Neg_Time_Remaining", "ROLL")
    setControlString("Time_Remaining", "")
  elseif playback == "stop" then
    setControlString("Neg_Time_Remaining", "")
    setControlString("Time_Remaining", "-- : -- : --")
  else 
    local timerCurrent = payload.timer.current
    local isNegative = false
    local timerValue = 0

    if type(timerCurrent) == "number" then
      isNegative = timerCurrent < 0
      timerValue = math.abs(timerCurrent)
    elseif type(timerCurrent) == "string" then
      isNegative = timerCurrent:sub(1, 1) == "-"
      timerValue = tonumber(timerCurrent:sub(isNegative and 2 or 1)) or 0
    end

    -- Convert milliseconds to seconds
    local totalSeconds = math.floor(timerValue / 1000)
    local hours = math.floor(totalSeconds / 3600)
    local minutes = math.floor((totalSeconds % 3600) / 60)
    local seconds = totalSeconds % 60

    local timerFormatted = string.format("%02d:%02d:%02d", hours, minutes, seconds)
    if isNegative then timerFormatted = "-" .. timerFormatted end

    setControlString("Neg_Time_Remaining", isNegative and timerFormatted or "")
    setControlString("Time_Remaining", isNegative and "" or timerFormatted)
  end

  -- Event handling
  local index = payload.runtime.selectedEventIndex + 1
  setControlVisibility("Event_Index", playback ~= "roll" and playback ~= "stop")
  setControlValue("Event_Index", index)

  local numEvents = payload.runtime.numEvents
  setControlValue("Event_Total", numEvents)

  -- Current event details
  setControlString("Event_Title", payload.eventNow.title)
  setControlString("Note", payload.eventNow.note)

  -- Next event details
  if index ~= numEvents then
    setControlString("Next_Event_Title", payload.eventNext.title)
    setControlString("Next_Note", payload.eventNext.note)
  else
    setControlString("Next_Event_Title", "End of Event List")
    setControlString("Next_Note", "End of Event List")
  end

  -- Timer blinking
  local isBlinking = payload.message.timer.blink
  setControlValue("Blink", isBlinking and 1 or 0)
  if isBlinking then startFlashTimer() else stopFlashTimer() end

  -- Timer visibility
  local isTimerBlackedOut = payload.message.timer.blackout
  setControlValue("Blank", isTimerBlackedOut)
  setControlVisibility("Time_Remaining", not isTimerBlackedOut)
  setControlVisibility("Neg_Time_Remaining", not isTimerBlackedOut)

  -- Message visibility and content
  setControlValue("T-MessageVis", payload.message.timer.visible)
  setControlString("Current T-Message", payload.message.timer.text)
  setControlString("Current P-Message", payload.message.external.text)
  setControlValue("P-MessageVis", payload.message.external.visible)
end
 function LogFB(data)
    print("LOG DATA", data)
    --Error checking/successful command stuff goes here
    --print ("Command Issued")
  end
 function poll()
  running = {
   type = "poll",
  }
  -- Convert the Lua table to a JSON string
  local poll = json.encode(running)
  ws:Write(poll, false)
 end
 Controls.Play.EventHandler = function ()
     PLYMS = {
      type = "start",
    }
    -- Convert the Lua table to a JSON string
    local play_command = json.encode(PLYMS)
    ws:Write(play_command, false)
    print("sending", play_command)
 end
 Controls.Pause.EventHandler = function ()
    Pausems= {
        type = "pause",
      }
      -- Convert the Lua table to a JSON string
      local pause_command = json.encode(Pausems)
      ws:Write(pause_command, false)
      print("sending", pause_command)
 end
 Controls.Next.EventHandler = function ()
    nextms= {
      type = "load",
      payload = "next"
      }
      -- Convert the Lua table to a JSON string
      local next_command = json.encode(nextms)
      ws:Write(next_command, false)
      print("sending", next_command)
 end
 Controls.Previous.EventHandler = function ()
    Prems= {
        type = "load",
        payload = "previous"
      }
      -- Convert the Lua table to a JSON string
      local pre_command = json.encode(Prems)
      ws:Write(pre_command, false)
      print("sending", pre_command)
 end
 Controls.Restart.EventHandler = function ()
    Restartms= {
        type = "reload",
      }
      -- Convert the Lua table to a JSON string
      local restart_command = json.encode(Restartms)
      ws:Write(restart_command, false)
      print("sending", restart_command)
 end
 Controls["Minus 1"].EventHandler = function ()
   M1MS = {
    type = "addtime",
    payload = -60
   }
   -- Convert the Lua table to a JSON string
  local minus1_command = json.encode(M1MS)
  ws:Write(minus1_command, false)
  print("sending", minus1_command)
 end
 Controls["Plus 5"].EventHandler = function ()
  A5MS = {
   type = "addtime",
   payload = 300
  }
  -- Convert the Lua table to a JSON string
  local plus5_command = json.encode(A5MS)
  ws:Write(plus5_command, false)
  print("sending", plus5_command)
 end
 Controls["Minus 5"].EventHandler = function ()
  M5MS = {
  type = "addtime",
  payload = -300
  }
  -- Convert the Lua table to a JSON string
  local minus5_command = json.encode(M5MS)
  ws:Write(minus5_command, false)
  print("sending", minus5_command)
 end
 ---vvvvvvvFlashing Blink Logic :|
 function flashButton()
  Controls.BlinkBlink.Value = (Controls.BlinkBlink.Value == 1) and 0 or 1
  -- Update the visual appearance of the flashing button based on its value
  -- You may need to replace the line above with the appropriate code for your UI library

  -- Flash the strings based on the same toggle
  if Controls.BlinkBlink.Value == 1 then
      Controls.Neg_Time_Remaining.IsDisabled = true--not Controls.Neg_Time_Remaining.IsDisabled 
      Controls.Time_Remaining.IsDisabled  = true--not Controls.Time_Remaining.IsDisabled 
  else
      Controls.Neg_Time_Remaining.IsDisabled  = false -- Reset the visibility when flashing stops
      Controls.Time_Remaining.IsDisabled  = false -- Reset the visibility when flashing stops
  end
 end
 function startFlashTimer()
  -- Start the timer for flashing
  delay:Start(.6)
 end
 function stopFlashTimer()
  -- Stop the flashing timer
  delay:Stop()
  Controls.BlinkBlink.Value = 0 -- Reset the visibility when flashing stops
  Controls.Neg_Time_Remaining.IsDisabled  = false -- Reset the visibility when flashing stops
  Controls.Time_Remaining.IsDisabled  = false -- Reset the visibility when flashing stops
   -- Reset the value to 0 when the flashing stops
  -- Update the visual appearance of the flashing button to its initial state
  -- You may need to replace the line above with the appropriate code for your UI library
 end
 function Blink()

  if Controls.Blink.Value == 1 then
      -- Start the flashing timer
      Controls.BlinkBlink.Value = 1
      Controls.Neg_Time_Remaining.IsDisabled = true
      Controls.Time_Remaining.IsDisabled  = true
      startFlashTimer()
       BCMD = {
        type = "message",
        payload = {
          timer ={
              blink = true}
        }
        }
    else
      -- Stop the flashing timer
      stopFlashTimer()
     BCMD = {
        type = "message",
        payload ={
          timer ={
              blink = false}
        }
        }
  end

  -- Convert the Lua table to a JSON string
  local blink_command = json.encode(BCMD)
  ws:Write(blink_command, false)
  print("sending", blink_command)
 end
 ---^^^^^^Flashing Blink Logic :|
 Controls["T-MessageVis"].EventHandler = function ()
    if Controls["T-MessageVis"].Boolean
    then
      TVCMD= {
        type = "message",
        payload = {
        timer = {
        visible = true
          }
        }
      }
    Controls["Current T-Message"].IsInvisible = true
    else
      TVCMD= {
        type = "message",
        payload = {
        timer = {
        visible = false
          }
        }
      }
    Controls["Current T-Message"].IsInvisible = false
    end
    -- Convert the Lua table to a JSON string
    local textvis_command = json.encode(TVCMD)
    ws:Write(textvis_command, false)
    print("sending", textvis_command)
  end
 Controls["P-MessageVis"].EventHandler = function (PubTextVis)
    if Controls["P-MessageVis"].Boolean
    then 
      pubTVCMD= {
        type = "message",
        payload = {
        external = {
        visible = true
          }
        }
      }
    Controls["Current P-Message"].IsInvisible = true
    else
      pubTVCMD= {
        type = "message",
        payload = {
        external = {
        visible = false
          }
        }
      }
    Controls["Current P-Message"].IsInvisible = false
    end
    -- Convert the Lua table to a JSON string
    local pubtextvis_command = json.encode(pubTVCMD)
    ws:Write(pubtextvis_command, false)
    print("sending", pubtextvis_command)
  end   
 Controls["Send TimerMessage"].EventHandler = function (PresMess)
    local PresText = Controls["TimerMessage"].String
    local text = {
      type = "message",
      payload = {
      timer = {
      text = PresText
     }
    }
  }
    local json_message = json.encode(text)
    print("sending", json_message)
    ws:Write(json_message, false) 
  end
 Controls["Send PublicMessage"].EventHandler = function ()
    local pubText = Controls["PublicMessage"].String
    local text = {
      type = "message",
      payload = {
      external = {
      text = pubText}
    }
  }
    local json_message = json.encode(text)
        print("sending", json_message)
        ws:Write(json_message, false)
  end
 Controls.Blank.EventHandler = function (BlackOut)
    if Controls.Blank.Boolean
    then
     BOCMD = {
      type = "message",
      payload = {
        timer ={
            blackout = true
        }
        }
        }
    Controls.Time_Remaining.IsInvisible = true
    Controls.Neg_Time_Remaining.IsInvisible = true
    else
     BOCMD = {
        type = "message",
            payload ={ 
              timer ={
                  blackout = false
            }}}
     Controls.Time_Remaining.IsInvisible = false
     Controls.Neg_Time_Remaining.IsInvisible = false
    end
    -- Convert the Lua table to a JSON string
    local black_command = json.encode(BOCMD)
    ws:Write(black_command, false)
    print("sending", black_command)
 end 

 Controls.Blink.EventHandler = Blink
 delay.EventHandler = flashButton
 polltimer.EventHandler = poll

 --Run At Start

 Connect()

end